<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í”¼ì ë°°ë‹¬ ì‹œë®¬ë ˆì´ì…˜</title>
  </head>
  <body>
    <h1>í”¼ì ë°°ë‹¬ ì‹œë®¬ë ˆì´ì…˜</h1>

    <script>
      // ëª©í‘œ : ì¤‘ì²©ëœ ì½œë°±ìœ¼ë¡œ ì‘ì„±ëœ í”¼ìì£¼ë¬¸ ì‹œìŠ¤í…œì„ async/awaitì„ ì‚¬ìš©í•˜ì—¬ ë¦¬íŒ©í† ë§ í•˜ì„¸ìš”.

      // ë¯¸ì…˜ (index.htmlì— ì‘ì„±)
      // 1.  async function deliverPizza() ë§Œë“¤ê¸°
      // 2. ê° ë‹¨ê³„ë¥¼ awaitë¡œ ìˆœì°¨ ì‹¤í–‰
      // 3. try-catchë¡œ ì—ëŸ¬ ì²˜ë¦¬ í†µí•©
      // 4. ì„±ê³µ ì‹œ "ë°°ë‹¬ ì™„ë£Œ!" ì½˜ì†” ì¶œë ¥

      //   orderPizza("Pepperoni", (err, orderId) => {
      //     if (err) return handleError(err);

      //     makeDough(orderId, (err, dough) => {
      //       if (err) return handleError(err);

      //       bakePizza(dough, (err, pizza) => {
      //         if (err) return handleError(err);
      //         console.log(`${pizza.name} ë°°ë‹¬ ì™„ë£Œ! ğŸ•`);
      //       });
      //     });
      //   });

      // 1. ê¸°ì¡´ ì½œë°± í•¨ìˆ˜ë“¤ì„ Promise ë°©ì‹ìœ¼ë¡œ ì •ì˜í•©ë‹ˆë‹¤.
      const orderPizza = (type) => {
        return new Promise((resolve, reject) => {
          console.log(`${type} ì£¼ë¬¸ ì ‘ìˆ˜ ì¤‘...`);
          setTimeout(() => resolve("ORD-123"), 1000); // 1ì´ˆ í›„ ì£¼ë¬¸ë²ˆí˜¸ ë°˜í™˜
        });
      };

      const makeDough = (orderId) => {
        return new Promise((resolve) => {
          console.log(`ì£¼ë¬¸ë²ˆí˜¸ ${orderId}: ë„ìš° ë§Œë“œëŠ” ì¤‘...`);
          setTimeout(() => resolve("ìˆ™ì„±ëœ ë„ìš°"), 1000);
        });
      };

      const bakePizza = (dough) => {
        return new Promise((resolve) => {
          console.log(`${dough}ë¡œ í”¼ì êµ½ëŠ” ì¤‘...`);
          setTimeout(() => resolve({ name: "Pepperoni Pizza" }), 1000);
        });
      };

      // 2. ì‘ì„±í•˜ì‹  ë¦¬íŒ©í† ë§ ì½”ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
      async function deliverPizza() {
        try {
          console.log("ì£¼ë¬¸ì„ ì‹œì‘í•©ë‹ˆë‹¤.");

          // 1. ì£¼ë¬¸í•˜ê¸° (ì¸ì ì „ë‹¬)
          const orderId = await orderPizza("Pepperoni");

          // 2. ë„ìš° ë§Œë“¤ê¸°
          const dough = await makeDough(orderId);

          // 3. êµ½ê¸°
          const pizza = await bakePizza(dough);

          //   4. ì„±ê³µ ë©”ì‹œì§€ ì¶œë ¥
          console.log(`${pizza.name} ë°°ë‹¬ ì™„ë£Œ!`);
        } catch (error) {
          // ëª¨ë“  ë‹¨ê³„ ì¤‘ í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ì´ìª½ìœ¼ë¡œ ì í”„
          console.error("í”¼ì ë°°ë‹¬ ì¤‘ ì—ëŸ¬ ë°œìƒ", error);
        }
      }

      deliverPizza();
    </script>
  </body>
</html>
